{% extends 'base.html' %}
{% block title %}Manage Exam - {{ exam.title }}{% endblock %}

{% block topbar %}
<div class="brand">
    <span class="brand-mark">C</span>
    <div class="brand-text">
        <strong>CEMS</strong>
        <small>Manage marks</small>
    </div>
</div>
<div class="top-actions">
    <div class="status-dot online"></div>
    <span class="status-label">Logged in as {{ request.user.username }}</span>
    <div class="chip">Teacher</div>
    <a class="btn ghost" href="{% url 'academics:teacher_dashboard' %}">Back to dashboard</a>
</div>
{% endblock %}

{% block sidebar %}
<div class="sidebar-group">
    <p class="sidebar-label">Exam</p>
    <nav class="menu">
        <a href="{% url 'academics:teacher_dashboard' %}" class="menu-link">Exams</a>
        <a href="#" class="menu-link active">Manage</a>
        <a href="{% url 'exams:teacher_exam_results' exam.id %}" class="menu-link">Results</a>
    </nav>
</div>
{% endblock %}

{% block content %}
<section class="section">
    <div class="section-header">
        <div>
            <p class="eyebrow">Mark entry</p>
            <h2>{{ exam.title }} — {{ exam.class_level }} — {{ exam.subject }}</h2>
        </div>
        <div class="hint">Enter marks or leave blank; attendance defaults to present.</div>
    </div>

    <div class="card">
        <div class="table-scroll">
            <table class="table compact">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>ID</th>
                        <th>Roll</th>
                        <th>Marks</th>
                        <th>Attendance</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in rows %}
                    <tr>
                        <td>{{ row.student.user.get_full_name|default:row.student.user.username }}</td>
                        <td>{{ row.student.student_id|default:"N/A" }}</td>
                        <td>{{ row.roll_number|default:"-" }}</td>
                        <td>
                            <form method="post" class="inline-form">
                                {% csrf_token %}
                                <input type="hidden" name="student_identifier" value="{{ row.student.student_id|default:row.student.user.username }}">
                                <input type="number" step="0.01" name="marks_obtained" value="{{ row.marks|default_if_none:'' }}" placeholder="—" class="inline-input">
                        </td>
                        <td>
                                <select name="attendance" class="inline-input">
                                    <option value="present" {% if row.attendance == 'present' %}selected{% endif %}>Present</option>
                                    <option value="absent" {% if row.attendance == 'absent' %}selected{% endif %}>Absent</option>
                                </select>
                        </td>
                        <td>
                                <button class="btn primary small" type="submit">Save</button>
                            </form>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="6" class="muted">No students enrolled for this class.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>
{% endblock %}
